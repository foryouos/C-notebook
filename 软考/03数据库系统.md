# 03数据库系统

https://www.cnblogs.com/cainiao-chuanqi/p/10433188.html

[数据库系统](https://www.cnblogs.com/cainiao-chuanqi/p/10433188.html)

## 数据库系统

> * 上午选择题
> * 下午 大题
>
> 6 \~ 8 分

* 三级模式 - 两层映射
* 外模式
* 内模式
* 概念模式
* 数据库设计过程
* 数据库模型
* ER模型  15分
* 关系代数
* 自然连接
* 规范化理论
* SQL语言
* 并发控制
  * S锁 ： 共享锁
  * X封锁 ： 排他锁
* 数据库完整性约束

## 做题笔记

* 对于关系R,满足A能够遍历全图，所以R和S的主键都是A
* 事务：
  * 原子性 : 要么做，要么都不做
  * 一致性 ： 事务执行的结果必须保证数据库从一个一致性状态变成另一个一致性状态
  * 隔离性 ： 事务相互隔离，当多个事务并发执行，任一事务的更新操作，直到其成功提交整个过程，对其它事物都是不可见
  * 持久性：一旦事务成功提交，即使数据库崩溃，其对数据库的更新操作也是永久有效。
* 数据库设计分为四个阶段：用户需求分析，概念结构，逻辑结构和物理结构四个阶段。用户需求分析阶段形成的相关文档用以作为概念结构设计的设计依据。
* 需求分析阶段的主要任务：对现实世界要处理的对象进行详细调查，在了解现行系统的概况，确定新系统功能的过程中，确定系统边界，收集支持系统目标的基础数据及其处理方法。在此阶段，形成需求<mark style="color:red;">说明文档</mark>，<mark style="color:red;">数据字典</mark>和<mark style="color:red;">数据流程图</mark>。
* <mark style="color:blue;">逻辑设</mark>计的主要任务：对关系模式进一步<mark style="color:red;">规范化处理</mark>。因为生成的初始化关系模式并不是完全符合要求，会有数据冗余，更新异常，需要根据规范化理论对关系模式进行分解，以消除冗余和更新异常。逻辑设计的任务就需要做部分关系模式的处理，分解，合并或添加冗余属性，提高存储效率和处理效率。
* 冲突
  * 结构冲突：指同一实体在不同的ER图中有不同的属性、
  * 属性冲突：指同一属性可能会存在于不同的ER图
* 授权语句：<mark style="color:blue;">GRANT INSERT ON TABLE Student to UserA WITH GRANT OPTION</mark> 授予用户UserA权限的同时，同时赋予此用户可以将权限授予给其它人。
* 自然联结：要求两个关系中进行比较的分量必须是相同的属性，并切在结果集中将重复属性列去掉。
  * 自然联结的结果以左侧R为主，右侧关系S去除重复列。
* 数据库管理系统利用<mark style="color:purple;">日志文件</mark>来进行事务故障恢复和系统故障恢复。DBMS把事物开始，结束以及对数据库的插入，删除和修改的每一次操作<mark style="color:red;">写入日志文件</mark>，当系统正常运行时，按一定的时间间隔，把<mark style="color:blue;">数据缓冲区内</mark>容写入<mark style="color:red;">数据文件</mark>，一旦发生故障，DBMS的恢复子雄利用日志文件撤销事务对数据库的改变，回退到事务的初始状态。
* 在关系型数据库中，全码(ALL-key)是指关系模型的所有属性组是这个关系模式的候选键。
* 数据库通常采用三级模式，其中视图对应外模式，基本表对应模式，存储文件对应内模式。
* 物理独立性是指的内模式发生变化，只需要调整模式与内模式之间的映像，无需修改应用程序。
* 逻辑独立性是指模式发生变化，只需调整外模式模式之间的映像，而不用修改应用程序。
* 为保证数据库处于一致的状态，在并发控制中引入两种锁，排他锁(Exclusive Locks，X锁) , 共享锁(Share Locks ，S锁) &#x20;
* 排他锁又称为写锁，用于对数据进行写操作时进行锁定。如果事务T对数据A加上X锁后，就智能允许事务T读取和修改数据A，其它事务对数据A不能再加任何锁， 从而也不能读取和修改数据A，直到事务T释放A上的锁。
* 共享锁 又称为 读锁，用于对数据进行读操作时进行锁定。如果事务T对数据A加上S锁后，事务T就只能读数据A但不可以修改，其他事务可以再对数据A加S锁来读取，只要数据A上有S锁，任何事务都只能再对S锁(读取)而不能加X锁(修改)
* 聚簇索引：按照每张表的主键构造一颗B+树，同时叶子节点中存放的就是整张表的的行记录数据，也将聚集索引的叶子节点称为数据页。此特征决定了索引组织表中数据也是索引的一部分，每张表只能拥有一个聚簇索引。
  * 优点：数据访问更快，聚簇索引对于主键的排序查找和范围查找速度非常快。
  * 缺点：插入速度严重依赖于插入顺序，按照主键的顺序插入是最快的方式，否则会出现页分裂，严重影响性能，更新主键的代价很高，二级索引访问需要两次索引查找，第一次找到主键值，第二次根据主键值找到行数据。
  * 在数据库中，如果对数据库的一张表创建聚簇索引，意味着重新确定表中数据的物理顺序，即需要改变的是数据库的内模式。聚簇索引对于那些经常要搜索范围值的列特别有效。
* 加入一对多联系不转换为一个独立的关系模式，那么按照ER模型向关系模型转换的规则，应当将一端主键并入多端。
* \`家庭住址\`记录了邮编，省，市，街道信息，那家庭住址属性可以再分，因此它是一个复合属性，派生属性是指通过其他属性可以计算获得结果的属性。通常对实体中的多值属性，取实体的码和多值属性构成新增的关系模式，且该新增关系模式中，实体的码多值决定多值属性，属于平凡的多值依赖，关系属于4NF
* 分布式透明：
  * 分片透明：指用户不必关系数据是如何分片的，它们对数据的操作在全局关系上进行，即关系如何分片对用户是透明的，因此当分片改变时应用程序可以不变。
  * 复制透明：用户不用关系数据库在网络中各个节点的复制情况，被复制的数据的更新都由系统自动完成。
  * <mark style="color:blue;">位置透明</mark>：是指用户不必知道所操作的数据放在何处，即数据<mark style="color:red;">分配到哪个或哪些节点存储对用户是透明的</mark>。
  * 局部映像透明性(逻辑透明) 是最低层次的透明性，该透明性提供数据到局部数据库的影响，即用户不必关系局部DBMS支持那种数据操作语言，数据模型和操纵语言的转换是由系统完成的。因此局部映像透明性对异构型和同构型异质的分布式数据库系统是非常重要的。
* 对一个给定的关系模式进行分解，使得分解后的模式是否与原来的模式等价存在三种情况：
  * 分解具有无损连接性
  * 分解要保持函数依赖
  * 分解既要无损连接性，又要保持函数依赖。
* 投影运算n是向关系的<mark style="color:blue;">垂直方向进行运算</mark>，其含义为在关系R中选择出<mark style="color:red;">若干属性列组成新的关系</mark>，记作：πAi1，Ai2，…，Aii（R） = {t\[Ai1，Ai2，…，Ain]| t∈R]。
* select多表查询，可以使用<mark style="color:blue;">select \* from t1,t2</mark>
* 2NF规范，判断是否存在传递依赖，所有属性都由主键决定全部属性。
* SQL自定义函数

```sql
CREATE  FUNCTION  function_name(@parameter_name   parameter_data_type) --（@参数名 参数的数据类型）

RETURN date_type   --返回返回值的数据类型

[WITH ENCRYPTION]  --如果指定了 encryption 则函数被加密

[AS]

BEGIN

  function_body --函数体

  RETURN  表达式;

END
-- 例子 创建标量函数，计算指定课程号的课程的平均成绩，然后调用该函数查询某门课的平均成绩。*/
 
create function getavgdegreeofonecourse(@课程号 char(5))
returns float
begin
	declare @result float
	select @result=avg(degree) 
	from score 
	where score.cno=@课程号
	return @result
end
```
